<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahsul Courses</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>
    <script src="javascript/products.js"></script>
</head>
<body>
    <div id="app" style="height: 100%; width: 100%;">
        <div class='navigation'>
            <img src="images/athlon.png" alt="">
            <p style="color: aliceblue; margin-left: 2%;">Athlon Classes</p>
            <button  v-on:click="showCheckout" v-if="cartItemCount > 0">
                <!-- {{cartItemCount}} -->
                {{cartItemCount}}
                <span class="fas fa-cart-plus"></span>
            </button>
            <button v-else>
                <span class="fas fa-cart-plus"></span>
            </button>
        </div>
        <div class='content'>
            <div class='left' style="padding: 2%;">
                <input v-model="search" placeholder="Search">
                <p><strong>Sort By:</strong></p>
                <p><input type="radio" id="title" value="Title" v-model="sort">
                    <label for="title">Title</label></p>
                <p><input type="radio" id="location" value="Location" v-model="sort">
                    <label for="location">Location</label></p>
                <p><input type="radio" id="price" value="Price" v-model="sort">
                    <label for="price">Price</label></p>
                <p><input type="radio" id="availability" value="Availability" v-model="sort">
                    <label for="availability">Availability</label></p>
            </div>
            <div class='right'>
                <main>
                    <div v-if="showProduct" style="width: 100%; margin: 2%; display: flex; flex-wrap: wrap;">
                        <div v-if="search==''" v-for="product in sortedProducts" style="width: 15%; padding: 2%; background-color: aliceblue; border-radius: 2%; margin: 2%;">
                            <figure>
                                <img v-bind:src = "product.image" height="100px" width="100px">
                            </figure>
                            <h2 v-text="product.title"></h2>
                            <p v-html="product.description"></p>
                            <p>Location: {{product.Location}}</p>
                            <p>Price: {{product.price}} </p>
                            <p>Available Inventory {{product.availableInventory - cartCount(product.id)}}</p>
                            <button v-on:click = "addToCart(product)" v-if="canAddToCart(product)">
                                Add to cart 
                            </button>
                            <button disabled="disabled" v-else>
                                Add to cart
                            </button>
                            <span v-if="product.availableInventory === cartCount(product.id)">All out!</span>
                                <span v-else-if="product.availableInventory - cartCount(product.id) < 10">Only {{product.availableInventory - cartCount(product.id)}} left!</span>
                                <span v-else>Buy now!</span>
                        </div>
                        <div v-if="search!=''" v-for="product in searchedProducts" style="width: 15%; padding: 2%; background-color: aliceblue; border-radius: 2%; margin: 2%;">
                            <figure>
                                <img v-bind:src = "product.image" height="100px" width="100px">
                            </figure>
                            <h2 v-text="product.title"></h2>
                            <p v-html="product.description"></p>
                            <p>Location: {{product.Location}}</p>
                            <p>Price: {{product.price}} </p>
                            <p>Available Inventory {{product.availableInventory - cartCount(product.id)}}</p>
                            <button v-on:click = "addToCart(product)" v-if="canAddToCart(product)">
                                Add to cart 
                            </button>
                            <button disabled="disabled" v-else>
                                Add to cart
                            </button>
                            <span v-if="product.availableInventory === cartCount(product.id)">All out!</span>
                                <span v-else-if="product.availableInventory - cartCount(product.id) < 10">Only {{product.availableInventory - cartCount(product.id)}} left!</span>
                                <span v-else>Buy now!</span>
                        </div>
                        
                    </div>
                    <div v-else>
                        <h2>Checkout</h2>
                        <div style="display: flex;">
                        <div v-for="product in cartProducts" style="width: 15%; padding: 2%; background-color: aliceblue; border-radius: 2%; margin: 2%;">
                            <figure>
                                <img v-bind:src = "product.image" height="100px" width="100px">
                            </figure>
                            <h2 v-text="product.title"></h2>
                            <p v-html="product.description"></p>
                            <p>Location: {{product.location}}</p>
                            <p>Quantity: {{cartCount(product.id)}}</p>
                            <p>Total Price: {{product.price}} </p>
                            <button v-on:click = "removeCart(product.id)">
                                Remove
                            </button>
                        </div>
                    </div>
                    </div>
                </main>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">
    
    let webstore = new Vue ({
        // specifies the Document Object Model (DOM)
        
        el: "#app",
        
        data: {
            sitename: "Vue.js Pet Depot",
            products: products, 
            showProduct: true,
            cart: [],
            search: '',
            sort: ''
        },
        methods: {
                addToCart: function(product){
                    this.cart.push(product.id);
                },
                showCheckout() {
                    this.showProduct = this.showProduct ? false : true;
                },
                canAddToCart(product) {
                    return product.availableInventory > this.cartCount(product.id);
                },
                cartCount(id) {
                        let count = 0;
                        for(let i = 0; i < this.cart.length; i++) {
                            if (this.cart[i] === id) {
                            count++;
                            }
                        }
                        return count;
                },
                findingProduct(id) {
                    for(let i = 0; i< this.products.length; i++){
                        if(this.products[i].id == id){
                            return products[i];
                        }
                    }
                },
                removeCart(id) {
                    function  removing(product){
                        return product !== id;
                    }
                    this.cart = this.cart.filter(removing)
                }
            },
        computed: {
            cartItemCount: function() {
                return this.cart.length || '';
            },
            sortedProducts() {
                    // the comparison function that defines the order
                    function compare(a, b) {
                        if (a.price > b.price) return 1;
                        if (a.price < b.price) return -1;
                        return 0;
                    }
                    // sort the 'products' array and return it
                    return this.products.sort(compare);
            },
            searchedProducts() {
                const search = (product) => {
                    return product.title.toLowerCase().includes(this.search.toLowerCase()) || product.description.toLowerCase().includes(this.search.toLowerCase());
                }
                return this.products.filter(search);
            },
            cartProducts() {
                const allProducts = (product) => {
                   return this.cart.includes(product.id);
                }
                return this.products.filter(allProducts);
            }
        },
    });
</script>
<style>
    html, body {
        height: 100%;
        margin: 0%;
    }

    .navigation{
        height: 5%;
        width: 100%;
        display: flex;
        justify-content: space-between;
        background-color: rgb(54, 69, 79);
    }
    .content{
        height: 100%;
        width: 100%;
        display: flex;
    }
    .left{
        height: 100%;
        width: 15%;
        background-color: rgb(229, 228, 226);
        overflow: auto;
    }
    .right{
        height: 100%;
        width: 85%;
        background-color: rgb(211, 211, 211);
        overflow: auto;
    }
   </style>
</html>